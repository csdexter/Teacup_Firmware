<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Teacup: dda_queue.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>dda_queue.c File Reference</h1>
<p><a class="el" href="structDDA.html" title="this is a digital differential analyser data struct">DDA</a> Queue - manage the move queue.  
<a href="#_details">More...</a></p>
<code>#include &quot;dda_queue.h&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;avr/interrupt.h&gt;</code><br/>
<code>#include &quot;config.h&quot;</code><br/>
<code>#include &quot;timer.h&quot;</code><br/>
<code>#include &quot;serial.h&quot;</code><br/>
<code>#include &quot;sermsg.h&quot;</code><br/>
<code>#include &quot;temp.h&quot;</code><br/>
<code>#include &quot;delay.h&quot;</code><br/>
<code>#include &quot;sersendf.h&quot;</code><br/>
<code>#include &quot;clock.h&quot;</code><br/>
<code>#include &quot;memory_barrier.h&quot;</code><br/>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structDDA.html">DDA</a> movebuffer[MOVEBUFFER_SIZE]&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a9474ff3ddcf3f6e201ffef872879dd6f">__attribute__</a> ((__section__(&quot;.bss&quot;)))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">move buffer.  <a href="#a9474ff3ddcf3f6e201ffef872879dd6f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a171effc065e0c376f365387454d59b21"></a><!-- doxytag: member="dda_queue.c::queue_full" ref="a171effc065e0c376f365387454d59b21" args="()" -->
uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a171effc065e0c376f365387454d59b21">queue_full</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">check if the queue is completely full <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a74503bc22971aa61fe73a42355481c1e"></a><!-- doxytag: member="dda_queue.c::queue_empty" ref="a74503bc22971aa61fe73a42355481c1e" args="()" -->
uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a74503bc22971aa61fe73a42355481c1e">queue_empty</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">check if the queue is completely empty <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a300cfbb20d2af0ce7631896d71476ea4"></a><!-- doxytag: member="dda_queue.c::queue_step" ref="a300cfbb20d2af0ce7631896d71476ea4" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a300cfbb20d2af0ce7631896d71476ea4">queue_step</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Take a step or go to the next move. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a193482ac684f7821247a53c34b18179e">enqueue</a> (<a class="el" href="structTARGET.html">TARGET</a> *t)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add a move to the movebuffer  <a href="#a193482ac684f7821247a53c34b18179e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abe801786442d42dab750fe9b921e5bc8"></a><!-- doxytag: member="dda_queue.c::enqueue_home" ref="abe801786442d42dab750fe9b921e5bc8" args="(TARGET *t, uint8_t endstop_check, uint8_t endstop_stop_cond)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><b>enqueue_home</b> (<a class="el" href="structTARGET.html">TARGET</a> *t, uint8_t endstop_check, uint8_t endstop_stop_cond)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a14f2f4d5315855ebdc79b49dabe5f612">next_move</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">go to the next move.  <a href="#a14f2f4d5315855ebdc79b49dabe5f612"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a3b5e2fef85d5401a65d922ea5b1074bf">print_queue</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">DEBUG - print queue.  <a href="#a3b5e2fef85d5401a65d922ea5b1074bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a8dc97cd2b0a884c6a8511933726c8b52">queue_flush</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">dump queue for emergency stop.  <a href="#a8dc97cd2b0a884c6a8511933726c8b52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8e0f11589eb6803feca4b0511cd060ab"></a><!-- doxytag: member="dda_queue.c::queue_wait" ref="a8e0f11589eb6803feca4b0511cd060ab" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a8e0f11589eb6803feca4b0511cd060ab">queue_wait</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">wait for queue to empty <br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a444da641b993d774f0d23894ed11158b">mb_head</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">movebuffer head pointer.  <a href="#a444da641b993d774f0d23894ed11158b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dda__queue_8c.html#a358d89860a67c960c5976508b5716f20">mb_tail</a> = 0</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">movebuffer tail pointer.  <a href="#a358d89860a67c960c5976508b5716f20"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p><a class="el" href="structDDA.html" title="this is a digital differential analyser data struct">DDA</a> Queue - manage the move queue. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a9474ff3ddcf3f6e201ffef872879dd6f"></a><!-- doxytag: member="dda_queue.c::__attribute__" ref="a9474ff3ddcf3f6e201ffef872879dd6f" args="((__section__(&quot;.bss&quot;)))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDDA.html">DDA</a> movebuffer [MOVEBUFFER_SIZE] __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__section__(&quot;.bss&quot;))&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>move buffer. </p>
<p>holds move queue contents are read/written both in and out of interrupts, but once writing starts in interrupts on a specific slot, the slot will only be modified in interrupts until the slot is is no longer live. The size does not need to be a power of 2 anymore! </p>

</div>
</div>
<a class="anchor" id="a193482ac684f7821247a53c34b18179e"></a><!-- doxytag: member="dda_queue.c::enqueue" ref="a193482ac684f7821247a53c34b18179e" args="(TARGET *t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enqueue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structTARGET.html">TARGET</a> *&nbsp;</td>
          <td class="paramname"> <em>t</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add a move to the movebuffer </p>
<dl class="note"><dt><b>Note:</b></dt><dd>this function waits for space to be available if necessary, check <a class="el" href="dda__queue_8c.html#a171effc065e0c376f365387454d59b21" title="check if the queue is completely full">queue_full()</a> first if waiting is a problem This is the only function that modifies mb_head and it always called from outside an interrupt. </dd></dl>

<p>Referenced by <a class="el" href="home_8c_source.html#l00068">home_x_positive()</a>, <a class="el" href="home_8c_source.html#l00138">home_y_positive()</a>, <a class="el" href="home_8c_source.html#l00209">home_z_positive()</a>, and <a class="el" href="gcode__process_8c_source.html#l00059">process_gcode_command()</a>.</p>

</div>
</div>
<a class="anchor" id="a14f2f4d5315855ebdc79b49dabe5f612"></a><!-- doxytag: member="dda_queue.c::next_move" ref="a14f2f4d5315855ebdc79b49dabe5f612" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void next_move </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>go to the next move. </p>
<p>be aware that this is sometimes called from interrupt context, sometimes not. Note that if it is called from outside an interrupt it must not/can not by be interrupted such that it can be re-entered from within an interrupt. The timer interrupt MUST be disabled on entry. This is ensured because the timer was disabled at the start of the ISR or else because the current move buffer was dead in the non-interrupt case (which indicates that the timer interrupt is disabled). </p>

<p>Referenced by <a class="el" href="dda__queue_8c_source.html#l00067">queue_step()</a>.</p>

</div>
</div>
<a class="anchor" id="a3b5e2fef85d5401a65d922ea5b1074bf"></a><!-- doxytag: member="dda_queue.c::print_queue" ref="a3b5e2fef85d5401a65d922ea5b1074bf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_queue </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>DEBUG - print queue. </p>
<p>Qt/hs format, t is tail, h is head, s is F/full, E/empty or neither </p>

<p>Referenced by <a class="el" href="clock_8c_source.html#l00025">clock_250ms()</a>, and <a class="el" href="gcode__process_8c_source.html#l00059">process_gcode_command()</a>.</p>

</div>
</div>
<a class="anchor" id="a8dc97cd2b0a884c6a8511933726c8b52"></a><!-- doxytag: member="dda_queue.c::queue_flush" ref="a8dc97cd2b0a884c6a8511933726c8b52" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void queue_flush </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>dump queue for emergency stop. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>effect on startpoint is undefined! </dd></dl>

<p>Referenced by <a class="el" href="gcode__process_8c_source.html#l00059">process_gcode_command()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a444da641b993d774f0d23894ed11158b"></a><!-- doxytag: member="dda_queue.c::mb_head" ref="a444da641b993d774f0d23894ed11158b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="dda__queue_8c.html#a444da641b993d774f0d23894ed11158b">mb_head</a> = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>movebuffer head pointer. </p>
<p>Points to the last move in the queue. this variable is used both in and out of interrupts, but is only written outside of interrupts. </p>

<p>Referenced by <a class="el" href="dda__queue_8c_source.html#l00174">print_queue()</a>, <a class="el" href="dda__queue_8c_source.html#l00049">queue_empty()</a>, <a class="el" href="dda__queue_8c_source.html#l00180">queue_flush()</a>, and <a class="el" href="dda__queue_8c_source.html#l00039">queue_full()</a>.</p>

</div>
</div>
<a class="anchor" id="a358d89860a67c960c5976508b5716f20"></a><!-- doxytag: member="dda_queue.c::mb_tail" ref="a358d89860a67c960c5976508b5716f20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="dda__queue_8c.html#a358d89860a67c960c5976508b5716f20">mb_tail</a> = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>movebuffer tail pointer. </p>
<p>Points to the currently executing move this variable is read/written both in and out of interrupts. </p>

<p>Referenced by <a class="el" href="clock_8c_source.html#l00025">clock_250ms()</a>, <a class="el" href="dda__queue_8c_source.html#l00149">next_move()</a>, <a class="el" href="dda__queue_8c_source.html#l00174">print_queue()</a>, <a class="el" href="gcode__process_8c_source.html#l00059">process_gcode_command()</a>, <a class="el" href="dda__queue_8c_source.html#l00049">queue_empty()</a>, <a class="el" href="dda__queue_8c_source.html#l00180">queue_flush()</a>, <a class="el" href="dda__queue_8c_source.html#l00039">queue_full()</a>, <a class="el" href="dda__queue_8c_source.html#l00067">queue_step()</a>, and <a class="el" href="dda_8c_source.html#l00715">update_current_position()</a>.</p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 26 Jul 2012 for Teacup by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
